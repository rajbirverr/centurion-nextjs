# Authentication & Security Guide

## Where Your Login Credentials Are Stored

### ‚úÖ **Supabase Database (Secure Cloud Storage)**

Your passwords and user data are stored in **Supabase**, which is a secure, enterprise-grade backend service. Here's how it works:

1. **Password Storage Location:**
   - Stored in Supabase's `auth.users` table (managed by Supabase Auth)
   - **NEVER stored in plain text** - automatically hashed using bcrypt
   - Your application code **never sees or stores the actual password**

2. **User ID Storage:**
   - User IDs are UUIDs (Universally Unique Identifiers) generated by Supabase
   - Stored in both:
     - `auth.users` table (Supabase Auth system)
     - `profiles` table (your custom user profile data)

3. **What Gets Stored:**
   ```
   auth.users table:
   - id (UUID)
   - email
   - encrypted_password (bcrypt hash - NOT the actual password)
   - created_at, updated_at
   - email_confirmed_at
   - etc.
   
   profiles table:
   - id (UUID - matches auth.users.id)
   - first_name
   - last_name
   - display_name
   - role (customer/admin)
   - etc.
   ```

## Security Features (Already Implemented)

### üîí **Password Security**

1. **Automatic Hashing:**
   - When a user signs up, Supabase automatically hashes the password using bcrypt
   - The password is hashed with a salt (random value) before storage
   - **Your code never handles plain text passwords** - Supabase does it all

2. **Password Verification:**
   - When logging in, Supabase compares the entered password with the stored hash
   - Uses secure cryptographic comparison (prevents timing attacks)
   - If passwords match, Supabase returns a secure session token

3. **Password Requirements:**
   - Minimum 6 characters (configurable in Supabase)
   - Can enforce complexity rules (uppercase, numbers, symbols)

### üîê **Session Management**

1. **Secure Tokens:**
   - After login, Supabase issues JWT (JSON Web Tokens)
   - Tokens are stored in HTTP-only cookies (can't be accessed by JavaScript)
   - Tokens expire automatically for security

2. **Token Refresh:**
   - Middleware automatically refreshes expired tokens
   - Users stay logged in seamlessly

### üõ°Ô∏è **Protection Against Common Attacks**

1. **SQL Injection:**
   - ‚úÖ Protected - Supabase uses parameterized queries
   - ‚úÖ Your code uses Supabase client, not raw SQL

2. **XSS (Cross-Site Scripting):**
   - ‚úÖ Protected - Passwords never stored in client-side code
   - ‚úÖ Tokens in HTTP-only cookies

3. **CSRF (Cross-Site Request Forgery):**
   - ‚úÖ Protected - Supabase handles CSRF tokens automatically

4. **Brute Force Attacks:**
   - ‚úÖ Protected - Supabase has rate limiting built-in
   - ‚úÖ Failed login attempts are logged and limited

5. **Password Theft:**
   - ‚úÖ Protected - Passwords are hashed (even if database is compromised, passwords can't be recovered)
   - ‚úÖ HTTPS encryption for all data transmission

## What You Need to Do (Security Checklist)

### ‚úÖ **Already Done:**
- [x] Using Supabase Auth (industry-standard security)
- [x] Passwords automatically hashed
- [x] Secure session management
- [x] HTTPS encryption (via Supabase)
- [x] Server-side authentication checks

### üîß **Recommended Additional Security:**

1. **Environment Variables:**
   ```env
   # Make sure these are in .env.local (NOT committed to git)
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

2. **Password Policy (Optional - in Supabase Dashboard):**
   - Go to Supabase Dashboard ‚Üí Authentication ‚Üí Settings
   - Enable password complexity requirements
   - Set minimum length (currently 6, recommend 8+)

3. **Email Verification (Recommended):**
   - Enable email confirmation in Supabase Dashboard
   - Prevents fake accounts

4. **Rate Limiting (Already Enabled):**
   - Supabase automatically limits login attempts
   - Prevents brute force attacks

5. **Two-Factor Authentication (Optional):**
   - Can be enabled in Supabase Dashboard
   - Adds extra security layer

## How to View Your Users in Supabase

1. Go to your Supabase Dashboard: https://supabase.com/dashboard
2. Select your project
3. Navigate to **Authentication** ‚Üí **Users**
4. You'll see:
   - User emails
   - User IDs (UUIDs)
   - Creation dates
   - **NOT passwords** (they're hashed and not visible)

## Important Security Notes

### ‚ùå **NEVER:**
- Store passwords in plain text
- Log passwords in console.log
- Send passwords via email
- Store passwords in localStorage or sessionStorage
- Commit .env files to git

### ‚úÖ **ALWAYS:**
- Use HTTPS in production
- Keep Supabase keys secret
- Use environment variables for sensitive data
- Let Supabase handle password hashing (don't try to hash manually)
- Use server-side authentication checks (already implemented)

## Current Implementation Status

Your authentication is **secure** because:

1. ‚úÖ Using Supabase Auth (battle-tested, used by thousands of apps)
2. ‚úÖ Passwords automatically hashed with bcrypt
3. ‚úÖ Secure session tokens in HTTP-only cookies
4. ‚úÖ Server-side authentication checks in middleware
5. ‚úÖ Protected routes require authentication
6. ‚úÖ Password reset functionality implemented securely

## Questions?

- **Q: Can I see user passwords?**  
  A: No, and you shouldn't be able to. Passwords are hashed and cannot be recovered.

- **Q: What if Supabase gets hacked?**  
  A: Even if the database is compromised, passwords are hashed and cannot be recovered. Users should still change passwords as a precaution.

- **Q: Where is my Supabase database?**  
  A: In Supabase's secure cloud infrastructure. You can check the region in your Supabase Dashboard ‚Üí Settings ‚Üí General.

- **Q: Can I backup user data?**  
  A: Yes, you can export data from Supabase Dashboard ‚Üí Database ‚Üí Backups.

